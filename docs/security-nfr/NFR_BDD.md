# BDD сценарии для Security NFR Workout Log

## NFR-01: Конфиденциальность тренировок

```
Feature: Защита доступа к тренировкам
  Scenario: Успешный доступ к своим тренировкам
    Given пользователь с ID=1 аутентифицирован
    When он запрашивает GET /workouts/
    Then возвращается 200 OK со списком его тренировок

  Scenario: Запрет доступа к чужим тренировкам
    Given пользователь с ID=1 аутентифицирован
    When он запрашивает GET /workouts/999 (чужая тренировка)
    Then возвращается 403 Forbidden
```

## NFR-02: Время ответа статистики

```
Feature: Быстрая загрузка статистики
  Scenario: Статистика загружается в пределах нормы
    Given сервис под нагрузкой 100 RPS
    When запрашивается GET /stats
    Then время ответа p95 ≤ 2 s

  Scenario: Статистика доступна при высокой нагрузке
    Given сервис под нагрузкой 200 RPS
    When запрашивается GET /stats
    Then возвращается 200 OK (не 5xx ошибка)
```

## NFR-05: Защита от brute-force

```
Feature: Блокировка при атаках подбора пароля
  Scenario: Успешный вход после 3 попыток
    Given IP 192.168.1.1 с 3 неудачными попытками входа
    When происходит успешная аутентификация
    Then возвращается 200 OK и счетчик сбрасывается

  Scenario: Блокировка IP после 5 неудачных попыток
    Given IP 192.168.1.1
    When происходит 5 неудачных попыток входа за 5 минут
    Then возвращается 429 Too Many Requests и блокировка на 15 минут
```

## NFR-07: Хэширование паролей

```
Feature: Безопасное хранение паролей
  Scenario: Пароль хэшируется при регистрации
    Given пользователь регистрируется с паролем "myPassword123"
    When пароль сохраняется в базе
    Then он хранится как bcrypt хэш с cost=12

  Scenario: Отклонение plain text пароля
    Given попытка сохранить пароль в plain text
    When система проверяет хэш
    Then возвращается ошибка валидации
```

## NFR-08: Безопасные ошибки

```
Feature: Информационная безопасность ошибок
  Scenario: Ошибка не раскрывает внутреннюю структуру
    Given происходит внутренняя ошибка сервера
    When клиент запрашивает любой endpoint
    Then в ответе отсутствует stack trace
```
