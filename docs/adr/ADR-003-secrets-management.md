# ADR-003: Secrets Management
Дата: 2025-10-22

Статус: Accepted

## Context
Workout Log API использует JWT для аутентификации и подключения к БД. Секреты не должны попадать в код репозитория.

## Decision
Использовать переменные окружения для всех секретов с fallback на .env файл в development окружении.

## Alternatives Considered
1. **Хранение в коде/конфигах**
   - Плюсы: Простота разработки, легкий доступ
   - Минусы: Риск утечки в репозитории, сложность ротации

2. **External Secrets Manager (HashiCorp Vault, AWS Secrets Manager)**
   - Плюсы: Высокая безопасность, автоматическая ротация, аудит
   - Минусы: Сложность настройки, зависимость от внешних сервисов

3. **Переменные окружения (выбранный вариант)**
   - Плюсы: Простота реализации, поддержка всеми платформами, изоляция по окружениям
   - Минусы: Риск неправильной настройки, ручная ротация

## Decision Rationale
Выбраны переменные окружения потому что:
- **Простота** соответствует текущей стадии проекта (MVP)
- **Универсальность** работает на любой платформе деплоя
- **Изоляция** обеспечивает безопасность между средами
- **Компромисс**: принимаем ручную ротацию ради простоты развертывания

## Security Impact
- **Снижение риска R6**: Утечка данных из БД (из Threat Model P04)
- **Соответствие NFR-07**: Безопасное хранение паролей (из P03)
- **Предотвращение утечки**: Секреты не в репозитории
- **KPI**: 0 секретов в коде, ротация каждые 90 дней

## Rollout Plan
### Definition of Done
- [ ] Создан .env.example с описанием required переменных
- [ ] JWT_SECRET и DATABASE_URL загружаются из окружения
- [ ] Настроена валидация обязательных переменных при старте
- [ ] Документация по настройке окружения

### План внедрения
- **Фаза 1 (Dev)**: Рефакторинг конфигурации приложения
- **Фаза 2 (Staging)**: Пилотное развертывание с проверкой загрузки секретов
- **Фаза 3 (Production)**: Canary deployment с feature-flag для управления источниками секретов

## Consequences
- **Плюсы:** Безопасное хранение секретов, простота ротации, изоляция окружений
- **Минусы:** Усложнение деплоя, зависимость от окружения

## Links
- NFR-07 (хэширование паролей)
- R6 (утечка данных из БД)
- app/core/config.py
